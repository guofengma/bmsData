<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<head>
<meta charset="utf-8">
<title>逾期数据统计</title>
<meta name="description" content="">
<meta name="author" content="">
<!-- Mobile Meta -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Favicon -->
<link href="css/bootstrap.css" rel="stylesheet">
<link href="fonts/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="css/animations.css" rel="stylesheet">
<link href="css/lateFee.css" rel="stylesheet">
<script type="text/javascript" src="js/jquery.min.js"></script>
<!-- <script type="text/javascript" src="js/times.js"></script>   -->

</head>

<body ng-app="myApp" ng-controller="customersCtrl">
	<!-- banner start -->
	<div class="banner-caption clearfix">
		<div id="title">
			<div class="caption-title clearfix" >
				<i class="title-left"><img src="img/title-left.png"></i>
				<p class="title-left-title-font">逾期数据统计</p>
				<i class="title-left"><img src="img/title-right.png"></i>
			</div>
			<div class="title-date" style="height: 40px;">
				<p style="height: 40px; text-align: center;">
					<span class="ym-menu">
						<button type="button" class="btn btn-primary" value="day">当天</button>
						<button type="button" class="btn btn-primary" value="week">本周</button>
						<button type="button" class="btn btn-primary" value="month">本月</button>
					</span>
				</p>
					
			</div>
		</div>
		<div id="main">
			<div class="col-md-12">
				<div class="row">
					<div id="title01" class="col-xs-12 col-sm-12 col-md-4">
						<div class="data-box1 clearfix" id="box01">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>逾期数量</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box1_top">
								<div id="box0" class="box-echart"></div>
							</div>
							
						</div>
						<div class="data-box1" id="box02" style="margin-top: 30px;">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>5万以下</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box1" class="box-echart box"></div>
						</div>
						<div class="data-box1" id="box03" style="margin-top: 30px;">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>5-10万</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box2" class="box-echart box"></div>
						</div>
					</div>
					<div id="title02"
						class="col-xs-6 col-sm-6 col-md-4 panel-top panel-bottom">
						<div class="data-box1 box1-back" id="box04">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>所有门店</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="store" class="box-echart-china"></div>
								<div class="data-box1-data">display:none
								<p id="dayMoney" class="data-box1-font1">
									<span><i>门店</i></span>&nbsp;
									<span>逾期金额:<i></i>元</span>&nbsp;
								</p>
								</div>
						</div>
						<div class="data-box1" id="box05" style="margin-top: 30px;" data-toggle="modal" data-target="#myModal">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title" style="width: 227px">
								<b class="data-title-left">[</b> <span>当天数据详情</span> <b
									class="data-title-right">]</b>
							</div>
							<div class="box-echart-middle" style="overflow:auto">
								<div id="table0" class="table-responsive" style="overflow:auto; color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>逾期数量</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  	
								<div id="table1" class="table-responsive" style="overflow:auto;color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>5万以下</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  	
								<div id="table2" class="table-responsive" style="overflow:auto;color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>5-10万</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  	
								<div id="table3" class="table-responsive" style="overflow:auto;color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>10-20万</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  
								<div id="table4" class="table-responsive" style="overflow:auto;color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>20-30万</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  
								<div id="table5" class="table-responsive" style="overflow:auto;color: #fff; display:none">
									<table class="table" style="font-size: x-small">
										<caption>30万以上</caption>
										<thead>
											<tr>
												<th>门店</th>
												<th>合同编号</th>
												<th>姓名</th>
												<th>合同金额</th>
												<th>逾期天数</th>
												<th>逾期总金额</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>  	
							</div>
							
						</div>
						<div class="data-box1" id="box06" style="margin-top: 30px;">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>逾期金额</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box3" class="box-echart-bottom"></div>
							
						</div>
					</div>
					<div id="title03" class="col-xs-12 col-sm-12 col-md-4">
						<div class="data-box1" id="box07">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title">
								<b class="data-title-left">[</b> <span>10-20万</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box4" class="box-echart"></div>
						</div>
						<div class="data-box1" id="box08" style="margin-top: 30px;">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title" style="width: 238px">
								<b class="data-title-left">[</b> <span>20-30万</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box5" class="box-echart"></div>
						</div>
						<div class="data-box1" id="box09" style="margin-top: 30px;">
							<i class="topL"></i> <i class="topR"></i> <i class="bottomL"></i>
							<i class="bottomR"></i>
							<div class="data-title" style="width: 238px">
								<b class="data-title-left">[</b> <span>30万以上</span> <b
									class="data-title-right">]</b>
							</div>
							<div id="box6" class="box-echart"></div>
						</div>
					</div>
				</div>
				<!--asad-->
			</div>
		</div>

	</div>
	</div>
	
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content"  style="width:900px;height:700px;overflow:auto;">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" 
							aria-hidden="true">×
					</button>
					<h4 class="modal-title" id="myModalLabel">
						当天数据详情
					</h4>
				</div>
				<div class="modal-body">
					按下 ESC 按钮退出。
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" 
							data-dismiss="modal">关闭
					</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->
	
	
	<!-- JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/echarts.min.js"></script>
<!-- 	<script type="text/javascript" src="/js/china.js"></script> -->
<!-- 	<script type="text/javascript" src="/js/angular.min.js"></script> -->
	<script type="text/javascript" src="js/lateFee.js"></script>
	<script>
		$(document).ready(function() {
			$(".data-title").each(function(index){
				var span = $(this).find("span");
				$(this).css("width", $(span).outerWidth()+60)
			});
			$("#box06").hide();
			
			var keys = ["late_num", "late_amount","principal_5w", "principal_5_10w", "principal_10_20w",
				"principal_20_30w","principal_30w" ];
			var urls = ["lateFee/day", "lateFee/weekAndMonth"];
			
			var myChart = echarts.init(document.getElementById("store"));
			
			//初始加载门店
			$.ajax({
				type : "get",
				url : 'lateFee/initStores',
				dataType : "json",
				success : function(json) {
					console.log(json);
					var stores = json.stores;
					var legendData = new Array();
					var seriesData = new Array();
					for (var i = 0; i < stores.length; i++) {
						var name = stores[i].short_name;
						var id = stores[i].id;
						
						 var obj = new Object();
				            obj.name = name;
				            obj.value = 0;
				            obj.id = id;
				         seriesData.push(obj);
				         legendData.push(name);
					}
					
					//初始加载门店
					var pieOption = {
						    title : {
						        text: '',
						        subtext: '',
						        x:'center'
						    },
						    tooltip : {
						        trigger: 'item',
						        formatter: "{a} <br/>{b} : {c} ({d}%)"
						    },
						    legend: {
						        type: 'scroll',
						        orient: 'vertical',
						        right: 10,
						        top: 20,
						        bottom: 20,
						        data: legendData,

						        selected: {}
						    },
						    series : [
						        {
						            name: '门店',
						            type: 'pie',
						            radius : '55%',
						            center: ['40%', '50%'],
						            data: seriesData,
						            itemStyle: {
						                emphasis: {
						                    shadowBlur: 10,
						                    shadowOffsetX: 0,
						                    shadowColor: 'rgba(0, 0, 0, 0.5)'
						                }
						            }
						        }
						    ]
						};
					myChart.setOption(pieOption);
					
					initDay(myChart.getOption());
				}
			});
			
			function initDay(option){
				var storeName = option.series[0].data[4].name;
				var id = option.series[0].data[4].id;
				$(".ym-menu button:first").removeClass("btn-primary").addClass("btn-success");
				
				url = urls[0];
				var data = {"type":3, "value":id, "selected":""};
				day(url, data, storeName);
			}
			
			//点击事件
			myChart.on("click", function(e) {
				var storeId = e.data.id;
				var storeName = e.data.name;
				var selected = $(".ym-menu button[class *= 'btn-success']").attr("value");
				var url;
				if(selected != null){
					if(selected != "day"){
						url = urls[1];
						var data = {"type":3, "value":storeId, "selected":selected};
						weekAndMonth(url, data, storeName);
					}else{
						url = urls[0];
						var data = {"type":3, "value":storeId, "selected":selected};
						day(url, data, storeName);
					}
				}else{
					alert("请选择时间！！");
				}
				
		     });
			
			//时间选择
			$(".ym-menu button").on("click", function(){
				$(this).removeClass("btn-primary").addClass("btn-success");
				$(this).siblings("button").removeClass("btn-success").addClass("btn-primary");
				
				var value = $(this).attr("value");
				if(value == "day"){
					$("#box05").show();
					$("#box06").hide();
					$("#dayMoney").show();
					
				}else{
					$("#box05").hide();
					$("#box06").show();
					$("#dayMoney").hide();
				}
			})
			
			
			function weekAndMonth(url, data, storeName){
				$.post(url, data, function(response){
					console.log(response);
					
					if(response.show_res_code == "-1"){
	 					alert(response.show_res_error);
	 				}else{
	 					var legendData = new Array();
	 					var series = new Array();
	 					
	 					var list = response.list;   console.log(list);
	 					for (var i = 0; i < list.length; i++) {
							var data = JSON.parse(list[i]);
							var xAxisData = data.show_res_body.month;
							for (var j = 0; j < xAxisData.length; j++) {
								 xAxisData[j]=xAxisData[j].substr(6,2);  
							}
							var seriesData = data.show_res_body.data
							
							var paras = {"storeName":storeName, "xAxisData":xAxisData, "seriesData":seriesData};
							
							if(i == 0){
								var div = document.getElementById("box0");
								late_num_barChart.initData(div, paras);
							}
							if(i == 1){
								var div = document.getElementById("box1");
								principal_5w_barChart.initData(div, paras);
							}
							if(i == 2){
								var div = document.getElementById("box2");
								principal_5_10w_barChart.initData(div, paras);
							}
							if(i == 3){
								var div = document.getElementById("box4");
								principal_10_20w_barChart.initData(div, paras);
							}
							if(i == 4){
								var div = document.getElementById("box5");
								principal_20_30w_barChart.initData(div, paras);
							}
							if(i == 5){
								var div = document.getElementById("box6");
								principal_30w_barChart.initData(div, paras);
							}
							if(i == 6){
								legendData.push(data.show_res_body.type)
								var obj = new Object();
								obj.name = data.show_res_body.type;
								obj.type = "bar";
								obj.data = seriesData;
								series.push(obj);
									paras.legendData = legendData;
									paras.series = series;
									
									var div = document.getElementById("box3");
									late_amount_barChart.initData(div, paras);
							}
						}
	 					
	 				}
				});
			}
			function day(url, data, storeName){
				$.post(url, data, function(response){
					console.log(response);
					
					var moneys = response.moneys;
					$("#dayMoney span i").each(function(index){
						if(index == 0){
							$(this).text(storeName);
						}else{
							$(this).text(parseFloat(moneys[index - 1]).toFixed(2));
						}
					});
					
					
					var list = response.list;
					var xAxisData = [];
					xAxisData[0]= response.date.substr(6,2);
 					for (var i = 0; i < list.length; i++) {
						var size = list[i].length;
						var seriesData = [];
						seriesData[0] = size;
						
						var paras = {"storeName":storeName, "xAxisData":xAxisData, "seriesData":seriesData};
						
						if(i == 0){
							var div = document.getElementById("box0");
							late_num_barChart.initData(div, paras);
							
							joinTd($("#table0 table tbody"), list[i]);
						}
						if(i == 1){
							var div = document.getElementById("box1");
							principal_5w_barChart.initData(div, paras);
							
							joinTd($("#table1 table tbody"), list[i]);
						}
						if(i == 2){
							var div = document.getElementById("box2");
							principal_5_10w_barChart.initData(div, paras);
							
							joinTd($("#table2 table tbody"), list[i]);
						}
						if(i == 3){
							var div = document.getElementById("box4");
							principal_10_20w_barChart.initData(div, paras);
							
							joinTd($("#table3 table tbody"), list[i]);
						}
						if(i == 4){
							var div = document.getElementById("box5");
							principal_20_30w_barChart.initData(div, paras);
							
							joinTd($("#table4 table tbody"), list[i]);
						}
						if(i == 5){
							var div = document.getElementById("box6");
							principal_30w_barChart.initData(div, paras);
							
							joinTd($("#table5 table tbody"), list[i]);
						}
						
						
					}
					
				});
				switchShow($("#table0"));
			}
			
			$("#box0").click(function(){
				switchShow($("#table0"));
			})
			$("#box1").click(function(){
				switchShow($("#table1"));
			})
			$("#box2").click(function(){
				switchShow($("#table2"));
			})
			$("#box4").click(function(){
				switchShow($("#table3"));
			})
			$("#box5").click(function(){
				switchShow($("#table4"));
			})
			$("#box6").click(function(){
				switchShow($("#table5"));
			})
			
			
			//tableDiv切换
			function switchShow(e){
				$(e).show();
				$(e).siblings().hide();
				
				$("#myModal").find(".modal-body").empty();
				var data = $(e).clone();
				$(data).find("table").css({"font-size":"15px", "color":"black"});
				$("#myModal").find(".modal-body").append(data);
			}
			
			//拼接td
			function joinTd(e, list){
				$(e).empty();
				for(var j=0; j< list.length; j++){
					var obj = list[j];
					var arr = new Array();
					arr.push("<td>"+obj.short_name+"</td>");
					arr.push("<td>"+obj.cus_contract_no+"</td>");
					arr.push("<td>"+obj.cus_name+"</td>");
				//	arr.push("<td>"+obj.cus_id_no+"</td>");
					arr.push("<td>"+obj.principal+"</td>");
					arr.push("<td>"+obj.overdue_days+"</td>");
					arr.push("<td>"+obj.late_fee+"</td>");
					
					$(e).append("<tr>"+arr.join(",")+"</tr>");
				}
			}
			
			
			
			
		})
	</script>
</body>

</html>